#!/usr/bin/env perl
use Modern::Perl;
use Text::Levenshtein qw(distance);

die "Please input an url." if (!@ARGV);
my ($serie) = @ARGV;
say $serie;

my $wanted = "985k";
my $attempt1 = `livestreamer $serie $wanted --player /usr/bin/mplayer`;

say $attempt1;
if ($attempt1 =~ /Available streams: (.+)/) {
    say $1;
    my @avail = split(/,/, $1);
    map {
        $_ =~ s/^\s+|\s+$//g;
        $_ =~ s/\([^)]+\)$//g;
    } @avail;

    my ($closest, $closest_ld);
    for my $x (@avail) {
        my $ld = distance($x, $wanted);
        say "$x: $ld";
        if (!$closest or $ld < $closest_ld) {
            $closest = $x;
            $closest_ld = $ld;
        }
    }

    say "Traying again with: $closest";
    my $attempt2 = `livestreamer $serie $closest --player /usr/bin/mplayer`;
}
