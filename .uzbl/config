# --- Core settings ---

set useragent               = Uzbl (Webkit @{WEBKIT_MAJOR}.@{WEBKIT_MINOR}) (@(+uname -sm)@ [@ARCH_UZBL])

# Dir structure
set home_dir                = @(echo "$HOME")@/.uzbl
set data_dir                = @home_dir/data
set scripts_dir             = @home_dir/scripts

# Interface paths.
set fifo_dir                = /tmp
set socket_dir              = /tmp

set shell_cmd               = sh -c

# --- General config aliases ---

set mode_config             = request MODE_CONFIG
set on_event                = request ON_EVENT
set on_set                  = request ON_SET
set modmap                  = request MODMAP
set ignore_key              = request IGNORE_KEY

set set_mode                = set mode =
set set_status              = set status_message =

# --- Hardcoded handlers ---

# --- Dynamic event handlers ---

@on_event REQ_NEW_WINDOW    event NEW_WINDOW %s

# Pretty load status
@on_event LOAD_START        @set_status <span foreground="khaki">wait</span>
@on_event LOAD_FINISH       @set_status <span foreground="gold">done</span>
@on_event LOAD_COMMIT       @set_status <span foreground="green">recv</span>

@on_event LOAD_FINISH       spawn @scripts_dir/history.sh

# Colorify uri pending on bookmark status
@on_event LOAD_START    set uri_color = @uri_no_bm_color
@on_event LOAD_COMMIT   spawn @scripts_dir/is_bookmarked.sh

# Switch to insert if we click on form, else switch to command
@on_event FORM_ACTIVE   @set_mode insert
@on_event ROOT_ACTIVE   @set_mode command

# --- Behaviour and appearance ---

set show_status             = 1
set status_top              = 1

# Icon
set icon                    = @data_dir/uzbl.png
set icon_path               = @icon

set status_background       = #303030

set modcmd_style            = weight="bold" foreground="red"
set keycmd_style            = weight="light" foreground="red"
set prompt_style            = foreground="grey"
set cursor_style            = underline="single"
set completion_style        = foreground="green"
set hint_style              = weight="bold"

set uri_bm_color            = "#FFF826"
set uri_no_bm_color         = "#99FF66"
set uri_color               = @uri_no_bm_color

set mode_section            = <span background="khaki" foreground="black">[\@[\@mode_indicator]\@]</span>
set keycmd_section          = [<span \@prompt_style>\@[\@keycmd_prompt]\@</span><span \@modcmd_style>\@modcmd</span><span \@keycmd_style>\@keycmd</span><span \@completion_style>\@completion_list</span>]
set progress_section        = <span foreground="#606060">\@[\@progress.output]\@</span>
set scroll_section          = <span foreground="#606060">\@[\@scroll_message]\@</span>
set uri_section             = <span foreground=\@uri_color>\@[\@uri]\@</span>
set name_section            = <span foreground="khaki">\@[\@NAME]\@</span>
set status_section          = <span foreground="orange">\@status_message</span>
set selected_section        = <span foreground="#606060">\@[\@SELECTED_URI]\@</span>

set download_section        = <span foreground="white">\@downloads</span>

set status_format           = <span font_family="monospace">@mode_section @keycmd_section @progress_section @name_section @status_section @scroll_section @selected_section @download_section</span>
set status_format_right     = <span font_family="monospace"><span foreground="#666">uri:</span> @uri_section</span>

set title_format_long       = \@keycmd_prompt \@raw_modcmd \@raw_keycmd \@TITLE - Uzbl browser <\@NAME> \@SELECTED_URI [\@PID]
set title_format_short  = \@TITLE - Uzbl [\@PID]

set progress.format  = %c

# Custom css

# --- Key bindings ---

@modmap <Mod1>              <Alt>
@modmap <space>             <Space>
@modmap <KP_Enter>          <Enter>
@modmap <dead_circumflex>   ^

# Win key
@ignore_key <Mod4>
@ignore_key <Mod4><Ctrl>
# Alt gr
@ignore_key <Mod5>
@ignore_key <ISO_*>
@ignore_key <ScrollLock>
@ignore_key <Shift>

set mode_bind               = request MODE_BIND

# Global bind
set bind                    = @mode_bind global
# Insert mode bind
set ibind                   = @mode_bind insert
# Command mode bind
set cbind                   = @mode_bind command
# Non-insert mode bind (edit-bind)
set ebind                   = @mode_bind global,-insert

# Switch back to command mode
@on_event ESCAPE            @set_mode
@on_event ESCAPE            event KEYCMD_CLEAR
@bind <Escape>              = event ESCAPE

# Keycmd editing
@ebind <Return>             = event KEYCMD_EXEC_CURRENT
@ebind <BackSpace>          = event KEYCMD_BACKSPACE

# Enter any command at runtime with : prefix
@cbind :<cmd:>_             = %s

# Uri opening
@cbind oo<uri:>_            = uri %s
@cbind O<uri:\@uri>_        = uri %s
@cbind oh                   = spawn @scripts_dir/load_url_from_history.sh
@cbind ob                   = spawn @scripts_dir/load_url_from_bookmarks.sh

# Navigation binds
@cbind H                    = back
@cbind L                    = forward
@cbind S                    = stop
@cbind r                    = reload
@cbind R                    = reload_ign_cache

# Page movement keys
@cbind j                    = scroll vertical 20
@cbind k                    = scroll vertical -20
@cbind j                    = scroll vertical 40
@cbind k                    = scroll vertical -40

@cbind h                    = scroll horizontal -20
@cbind l                    = scroll horizontal 20

@cbind <Ctrl>f              = scroll vertical 100%
@cbind <Ctrl>b              = scroll vertical -100%

@cbind gg                   = scroll vertical begin
@cbind G                    = scroll vertical end
@cbind ^                    = scroll horizontal begin
@cbind $                    = scroll horizontal end

# Page searching binds
@cbind /*                   = search %s
@cbind ?*                   = search_reverse %s
@cbind n                    = search
@cbind N                    = search_reverse

# Bookmarks
@cbind bb                   = spawn @scripts_dir/insert_bookmark.sh
@cbind br                   = spawn @scripts_dir/remove_bookmark.sh

# Web searching
@cbind sg<Google:>_         = uri https://www.google.com/search?q=\@<encodeURIComponent(%r)>\@
@cbind sb<Slackbuilds:>_    = uri http://slackbuilds.org/result/?search=\@<encodeURIComponent(%r)>\@

# Mode switching
@cbind i                    = @set_mode insert
@bind  <Ctrl>i              = @set_mode insert

# --- Mode configuration

set command                 = @mode_config command
set insert                  = @mode_config insert
set stack                   = @mode_config stack

# Command mode config.
@command keycmd_style       = foreground="red"
@command status_background  = #202020
@command mode_indicator     = C
@command keycmd_events      = 1
@command forward_keys       = 0
@command modcmd_updates     = 1

# Insert mode config.
@insert status_background   = #303030
@insert mode_indicator      = I
@insert forward_keys        = 1
@insert keycmd_events       = 0
@insert modcmd_updates      = 0

# Multi-stage-binding mode config.
@stack keycmd_style         = foreground="red"
@stack status_background    = #202020
@stack mode_indicator       = S
@stack prompt_style         = foreground="#888" weight="light"
@stack keycmd_events        = 1
@stack modcmd_updates       = 1
@stack forward_keys         = 0

set default_mode            = command

# --- Misc commands

# Home page
#set uri                     = madeoftree.se
set uri                     = google.se

