# --- Core settings ---

set default_mode    = command

set useragent       = Uzbl (Webkit @{WEBKIT_MAJOR}.@{WEBKIT_MINOR}.@{WEBKIT_MICRO}) (@(+uname -sm)@ [@ARCH_UZBL]) (Commit @COMMIT)
set fifo_dir        = /tmp
set socket_dir      = /tmp

# --- Shortcuts & Aliases ---

# Shorten event bindings
set modmap          = request MODMAP
set modkey_addition = request MODKEY_ADDITION
set ignore_key      = request IGNORE_KEY
set mode_bind       = request MODE_BIND
set on_event        = request ON_EVENT
set toggle_modes    = request TOGGLE_MODES
set progress        = request PROGRESS_CONFIG

set set_mode        = set mode =
set set_status      = set status_message =
set shell_cmd       = sh -c

set base_dir = /home/tree/.uzbl
set scripts_dir = @base_dir/scripts

# --- Event handling ---

set cookie_handler      = talk_to_socket $XDG_CACHE_HOME/uzbl/cookie_daemon_socket

# Reset keycmd on navigation
@on_event LOAD_START    @set_mode

# Status
@on_event LOAD_START    @set_status <span foreground="red">wait</span>
@on_event LOAD_COMMIT   @set_status <span foreground="green">recv</span>
@on_event LOAD_FINISH   @set_status <span foreground="gold">done</span>

# Switch to insert if we click on form, else switch to command
@on_event FORM_ACTIVE   @set_mode insert
@on_event ROOT_ACTIVE   @set_mode command

@on_event NEW_WINDOW    event NEW_TAB %s

@on_event LOAD_FINISH   spawn @scripts_dir/history.sh

@on_event DOWNLOAD_REQUEST  spawn @scripts_dir/download.sh %s \@proxy_url

@on_event ESCAPE set mode =

# --- Keymappings ---

# Remap
@modmap <Control>           <Ctrl>
@modmap <ISO_Left_Tab>      <Tab>
@modmap <space>             <Space>
@modmap <dead_circumflex>   ^
@modmap <dead_tilde>        ~

@modkey_addition <Shift> <Ctrl>  <Meta>
@modkey_addition <Shift> <Tab>   <Shift-Tab>
@modkey_addition <Shift> <Insert <Shift-Insert>

@ignore_key <ISO_*>
@ignore_key <Shift>
@ignore_key <dead_*>

# Different binding styles
set bind  = @mode_bind global
set ibind = @mode_bind insert
set cbind = @mode_bind command
set ebind = @mode_bind global,-insert

# Mouse middle click will open new tab
@bind <Button2> = sh 'if [ "\@SELECTED_URI" ]; then echo "event NEW_TAB \@SELECTED_URI" > $4; fi'

# Command editing binds
@ebind <Return>     = event KEYCMD_EXEC_CURRENT
@ebind <Left>       = event SET_CURSOR_POS -
@ebind <Right       = event SET_CURSOR_POS +
@ebind <BackSpace>  = event KEYCMD_BACKSPACE
@ebind <Delete>     = event KEYCMD_DELETE
@ebind <Tab>        = event START_COMPLETION

# Enter any command at runtime by prefixing a colon
@cbind :_ = %s

# Movement
@cbind j            = scroll vertical 20
@cbind k            = scroll vertical -20
@cbind h            = scroll horizontal -20
@cbind l            = scroll horizontal 20

@cbind <Ctrl>j      = scroll vertical 40
@cbind <Ctrl>k      = scroll vertical -40
@cbind <Ctrl>h      = scroll horizontal -40
@cbind <Ctrl>l      = scroll horizontal 40

@cbind <Ctrl>b      = scroll vertical -100%
@cbind <Ctrl>f      = scroll vertical 100%

@cbind gg           = scroll vertical begin
@cbind G            = scroll vertical end

# Navigation
@cbind r    = reload
@cbind R    = reload_ign_cache
@cbind S    = stop
@cbind H    = back
@cbind L    = forward

# Appearance
@cbind z    = toggle_status
@cbind 1    = set zoom_level = 1.0
@cbind 2    = set zoom_level = 1.2
@cbind zi   = zoom_in
@cbind zo   = zoom_out
@cbind zt   = toggle_zoom_type

# Page search
@cbind /*   = search %s
@cbind ?*   = search_reverse %s
# Jump between search results
@cbind n    = search
@cbind N    = search_reverse
@cbind sc   = dehilight

# Web search
@cbind sg<Google:>_         = uri https://www.google.com/search?q=\@<encodeURIComponent(%r)>\@
@cbind sd<Duck:>_           = uri https://duckduckgo.com/?q=\@<encodeURIComponent(%r)>\@
@cbind sw<Wolfram:>_        = uri http://www.wolframalpha.com/input/?i=\@<encodeURIComponent(%r)>\@
@cbind st<Tyda:>_           = uri http://tyda.se/search?w=\@<encodeURIComponent(%r)>\@
@cbind sW<Wikipedia:>_      = uri http://en.wikipedia.org/w/index.php?title=Special:Search&search=\@<encodeURIComponent(%r)>\@&go=Go
@cbind sG<Github:>_         = uri http://github.com/search?q=\@<encodeURIComponent(%r)>\@&type=Everything&repo=&langOverride=&start_value=1
@cbind si<Imdb:>_           = uri http://www.imdb.com/find?s=all&q=\@<encodeURIComponent(%r)>\@
@cbind ssb<SlackBuild:>_    = uri http://slackbuilds.org/result/?search=\@<encodeURIComponent(%r)>\@&sv=13.1

# Uri opening
@cbind o<uri:>_      = uri %s
@cbind O<uri:\@uri>_ = uri %s

# Vimperator style link following
set javascript_windows = 1
set follow_hint_keys = 0123456789

@cbind fl* = script @scripts_dir/follow.js '@follow_hint_keys %s'
# Open link in new tab
@cbind tl* = script @scripts_dir/follownew.js '@follow_hint_keys %s'

# Tabs
@cbind tn               = event NEW_TAB
@cbind to<uri:>_        = event NEW_TAB %s
@cbind tO<uri:\@uri>_   = event NEW_TAB %s

@cbind tq           = exit
@cbind tQ           = event CLEAN_TABS

@cbind tt           = event NEXT_TAB
@cbind tT           = event PREV_TAB
@cbind <Ctrl><Tab>  = event NEXT_TAB
@cbind <Meta><Tab>  = event PREV_TAB
@cbind ti<index:>_  = event GOTO_TAB %s

# Article queue
@cbind qpu          = spawn @scripts_dir/article_queue.py push
@cbind qpo          = spawn @scripts_dir/article_queue.py pop
@cbind qp _         = spawn @scripts_dir/article_queue.py pop %s
@cbind qap          = spawn @scripts_dir/article_queue.py append
@cbind qsh          = spawn @scripts_dir/article_queue.py shift
@cbind qn           = spawn @scripts_dir/article_queue.py forward
@cbind qN           = spawn @scripts_dir/article_queue.py back
@cbind ql           = spawn @scripts_dir/article_queue.py list

# Bookmarks
@cbind by       = set uri = http://news.ycombinator.net
@cbind bg       = set uri = https://gmail.com
@cbind bc       = set uri = https://www.google.com/calendar
@cbind br       = set uri = https://www.google.com/reader
@cbind btl      = set uri = http://teamliquid.net
@cbind bm       = set uri = http://madeoftree.net
@cbind bs       = set uri = http://www.linuxquestions.org/questions/search.php?f=14
@cbind bvas     = set uri = http://viperassassinsquad.freeforums.org/
@cbind bG       = set uri = http://github.com

# Mode switching
@bind <Escape>      = event ESCAPE

@cbind I            = @set_mode insert
@cbind i            = @toggle_modes command insert
@bind <Ctrl>i       = @toggle_modes command insert

@bind <Meta>Q       = exit

# Handy stuff
@cbind !dump    = sh "echo dump_config > $4"
@cbind !reload  = sh "sed '/^# === Post-load misc commands/,$d' $1 | grep '^set ' > $4"

# --- Appearance ---

set show_status = 1
set status_background = #303030
set status_top = 0

set icon = @base_dir/uzbl.png
set icon_path = @icon

set modcmd_style        = weight="bold" foreground="red"
set keycmd_style        = weight="light" foreground="red"
set prompt_style        = foreground="grey"
set cursor_style        = underline="single"
set completion_style    = foreground="green"
set hint_style          = weight = "bold"

set mode_section      = <span background="khaki" foreground="black">[\@[\@mode_indicator]\@]</span>
set keycmd_section    = [<span \@prompt_style>\@[\@keycmd_prompt]\@</span><span \@modcmd_style>\@modcmd</span><span \@keycmd_style>\@keycmd</span><span \@completion_style>\@completion_list</span>]
set progress_section  = <span foreground="#606060">\@[\@progress_format]\@</span>
set scroll_section    = <span foreground="#606060">\@[\@scroll_message]\@</span>
set uri_section       = <span foreground="#99FF66">\@[\@uri]\@</span>
set status_section    = <span foreground="orange">\@status_message</span>
set selected_section  = <span foreground="#606060">\@[\@SELECTED_URI]\@</span>

set status_format     = <span font_family="monospace">@mode_section @keycmd_section @progress_section @uri_section @selected_section @scroll_section</span>

set title_format_long   = \@keycmd_prompt \@raw_modcmd \@raw_keycmd \@TITLE - Uzbl \@SELECTED_URI
set title_format_short  = \@TITLE - Uzbl

@progress format  = %c

# Tabs
set switch_to_new_tabs  = 0
set multiline_tabs      = 0
set max_title_len       = 10

set uri = http://news.ycombinator.net
